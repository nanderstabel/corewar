/* ************************************************************************** */
/*                                                                            */
/*                                                        ::::::::            */
/*   vis_arena.c                                        :+:    :+:            */
/*                                                     +:+                    */
/*   By: lhageman <lhageman@student.codam.nl>         +#+                     */
/*                                                   +#+                      */
/*   Created: 2020/06/03 16:31:49 by lhageman      #+#    #+#                 */
/*   Updated: 2020/06/03 17:33:03 by lhageman      ########   odam.nl         */
/*                                                                            */
/* ************************************************************************** */

#include "vis.h"

void	draw_borders(t_graphics *graphics)
{
	int i;

	i = 0;
	wattron(graphics->data, COLOR_PAIR(10));
	wattron(graphics->arena, COLOR_PAIR(10));
	while (i < graphics->arenax)
	{
		mvwprintw(graphics->arena, 0, i, "*");
		mvwprintw(graphics->arena, graphics->y - 1, i, "*");
		i += 1;
	}
	i = 0;
	while (i < graphics->y)
	{
		mvwprintw(graphics->arena, i, 0, "*");
		mvwprintw(graphics->arena, i, graphics->arenax - 1, "*");
		i += 1;
	}
	i = 0;
	while (i < graphics->datax)
	{
		mvwprintw(graphics->data, 0, i, "*");
		mvwprintw(graphics->data, graphics->y - 1, i, "*");
		i += 1;
	}
	i = 0;
	while (i < graphics->y)
	{
		mvwprintw(graphics->data, i, graphics->datax - 1, "*");
		i += 1;
	}
	wrefresh(graphics->data);
	wrefresh(graphics->arena);
	wattroff(graphics->data, COLOR_PAIR(10));
	wattroff(graphics->arena, COLOR_PAIR(10));
}

int	ft_print_data(t_graphics *graphics, t_vm *vm)
{
	char *str;

	mvwprintw(graphics->data, 3, 4, "CYLE:");
	str = ft_itoa(vm->cycle_count);
	mvwprintw(graphics->data, 3, 20, str);
	ft_strdel(&str);
	mvwprintw(graphics->data, 4, 4, "CYCLE_TO_DIE:");
	str = ft_itoa(vm->ctd);
	mvwprintw(graphics->data, 4, 20, str);
	ft_strdel(&str);
	wrefresh(graphics->data);
	return (0);
}

int 	draw_arena(t_graphics *graphics, char *arena)
{
	int i;
	int x;
	int y;
	i = 0;
	x = 3;
	y = 2;
	char c[2];
	wattron(graphics->arena, COLOR_PAIR(9));
	wclear(graphics->arena);
	draw_borders(graphics);
	while (i < MEM_SIZE)
	{
		while (x < graphics->arenax - 3 && i < MEM_SIZE)
		{
			// if (i != 0 && i % 128 == 0)
			// 	break ;
			c[0] = arena[i];
			c[1] = '\0';
			mvwprintw(graphics->arena, y, x, c);
			x += 1;
			if ((i + 1) % 2 == 0)
				x += 1;
			i += 1;
		}
		x = 3;
		y += 1;
	}
	mvwprintw(graphics->data, 7, 3, ft_itoa(i));
	wrefresh(graphics->data);
	wrefresh(graphics->arena);
	return (0);
}

// int		ft_set_arena(t_graphics *graphics)
// {
// 	int		i;
// 	int		x;
// 	int		y;

// 	x = 2;
// 	y = 2;
// 	i = 0;
// 	wattron(graphics->arena, COLOR_PAIR(9));
// 	while (i < MEM_SIZE && y < graphics->y)
// 	{
// 		while (x < graphics->arenax - 2)
// 		{
// 			mvwprintw(graphics->arena, y, x, "0");
// 			x += 1;
// 			if (x % 3 == 0)
// 				x += 1;
// 			i += 1;
// 		}
// 		x = 2;
// 		y += 1;
// 	}
// 	wrefresh(graphics->arena);
// 	return (0);
// }

int	ft_initiate_arena(t_graphics *graphics, t_vm *vm)
{
	int		data_size;
	char	*arena;

	data_size = 5;
	graphics->x = 192 + 57 + 6;
	graphics->y = 37;
	graphics->arenax = 192 + 6;
	graphics->datax = 57;
	graphics->arena = newwin(graphics->y, graphics->arenax, 0, 0);
	graphics->data = newwin(graphics->y, graphics->datax, 0, graphics->arenax);
	draw_borders(graphics);
	draw_borders(graphics);
	ft_print_data(graphics, vm);
	arena = ft_memalloc(MEM_SIZE);
	for(int i = 0; i < MEM_SIZE; i++)
	{
		arena[i] = '0';
	}
	// arena = "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
	// ft_set_arena(graphics);
	draw_arena(graphics, arena);
	sleep(10);
	ft_close_windows(graphics);
	return (0);
}
